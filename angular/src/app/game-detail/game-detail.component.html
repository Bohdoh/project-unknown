<div class="columns">
  <div class="column is-one-fifth"></div>
  <div class="column is-three-fifths" *ngIf="game">
    <div class="box">
      <div class="title has-text-centered">{{ game.title }}</div>

      <div class="has-text-centered" *ngIf="game.image">
        <img [src]="'data:image/png;base64,' + game.image">
      </div>

      <div class="level">
        <div class="level-left">
          <div class="level-item is-size-7 is-italic">Author:&nbsp;
            <span>{{ game.author}}</span>
          </div>
        </div>
        <div class="level-right">
          <div class="level-item is-size-7 is-italic">Released:&nbsp;
            <span>{{ game.createdAt | date:'HH:mm dd.MM.yy' }}</span>
          </div>
        </div>
      </div>
      <article class="message is-dark">
        <div class="message-body" style="white-space: pre-line">{{ game.content }}</div>
      </article>
      <div class="level">
        <div class="level-left">
          <div class="level-item" *ngFor="let category of game.categories">
            <!--          <button class="button tag is-link" (click)="selectCategory(category.categoryId)">{{ category.name }}</button>-->
            <button class="button tag is-link">{{ category.name }}</button>
          </div>

        </div>
        <div class="level-item">
          <a [routerLink]='"/game/play/"+ game.id+"/"+game.title'>
            <button class="button is-size-4 is-align-items-baseline"><i class="fa-solid fa-play"></i>&nbsp;&nbsp;Play
            </button>
          </a>
        </div>

        <!-- TODO when user is logged in logic -->
        <div class="level-right">
          <div class="level-item">
            <!--          <a [routerLink]="['/login']">-->
            <!--            <div *ngIf="!sessionUser" class="level-item tag is-medium is-light mx-1 button">-->
            <!--              <span class="icon is-small mr-3"><i class="fa-solid fa-right-to-bracket"></i></span>Log-->
            <!--              in to Comment-->
            <!--            </div>-->
            <!--          </a>-->
            <!--          <a [routerLink]="['/edit', post.postId]">-->
            <!--            <div *ngIf="sessionUser && sessionUser.isAdmin()"-->
            <!--                 class="level-item tag is-medium mx-1 button">edit-->
            <!--            </div>-->
            <!--          </a>-->
            <!--          <a (click)="deletePost(post.postId)">-->
            <!--            <div *ngIf="sessionUser && sessionUser.isAdmin()"-->
            <!--                 class="level-item tag is-medium is-danger mx-1 button">-->
            <!--              delete-->
            <!--            </div>-->
            <!--          </a>-->
          </div>
        </div>
      </div>

    </div>
    <hr>


    <div class="tabs is-medium">
      <ul>
        <li [class.is-active]="showComment">
          <a (click)="switchCommentAndReviews('comments')">Comments</a>
        </li>
        <li [class.is-active]="showReview">
          <a (click)="switchCommentAndReviews('reviews')">Reviews</a>
        </li>
      </ul>
    </div>

    <div *ngIf="showComment">
      <!-- add comment -->
      <div *ngIf="isLoggedIn">
        <article class="media mx-6" id="commentStart">
          <figure class="media-left">
            <p class="image is-64x64">
              <img class="is-rounded" *ngIf="currentUser && currentUser.image !== ''"
                   [src]="'data:image/png;base64,' + currentUser.image" alt="Profile Picture">
              <img class="is-rounded" *ngIf="currentUser && currentUser.image === ''"
                   src="https://bulma.io/images/placeholders/128x128.png" alt="Profile Picture">
            </p>
          </figure>
          <form class="media-content" (ngSubmit)="addComment(commentContent)">
            <div class="field">
              <p class="control">
              <textarea class="textarea is-half" (input)="emojiConvertComment(commentContent)"
                        [(ngModel)]="commentContent" name="content"
                        placeholder="Add a comment..."></textarea>
              </p>
            </div>
            <nav class="level">
              <div class="level-left">
                <div class="level-item">
                  <button class="button is-info is-primary" [disabled]="!commentContent" type="submit">Submit</button>
                </div>
              </div>
            </nav>
          </form>
        </article>
      </div>
      <hr>
      <!-- normal comment -->
      <article class="media mx-6" *ngFor="let comment of game.comments">
        <!-- user info -->
        <figure class="media-left">
          <p class="image is-64x64 is-rounded">
            <img class="is-rounded" *ngIf="comment.enduser.image"
                 [src]="'data:image/png;base64,' + comment.enduser.image" alt="Profile Picture">
            <img class="is-rounded" *ngIf="!comment.enduser.image"
                 src="https://bulma.io/images/placeholders/128x128.png" alt="Profile Picture">
          </p>
        </figure>

        <!-- normal comment -->
        <div class="media-content" *ngIf="!(commentIdBeingEdited === comment.commentId)">
          <div class="content">
            <strong>
              <p>{{ comment.enduser.username }}</p>
            </strong><small> {{ comment.createdAt | date:'HH:mm:ss     dd-MM-yy' }}</small><br>
            <span>{{ comment.content }}</span>
          </div>
        </div>

        <!-- comment edit window -->
        <form class="media-content" (ngSubmit)="addComment(editCommentContent)"
              *ngIf="commentIdBeingEdited === comment.commentId">
          <div class="field">
            <p class="control">
              <textarea class="textarea is-half" (input)="emojiConvertComment(commentContent)"
                        [(ngModel)]="editCommentContent" name="content"
                        placeholder="Edit your comment..."></textarea>
            </p>
          </div>
          <nav class="level">
            <div class="level-left">
              <div class="level-item">
                <button class="button is-info is-primary" [disabled]="!editCommentContent" type="submit">Submit</button>
              </div>
            </div>
          </nav>
        </form>

        <!-- buttons for delete, edit  -->
        <div class="media-right">
          <a class="mr-2" *ngIf="canEditComment(comment)" (click)="showEditFormForComments(comment)"><i
            class="fa-solid fa-pen"></i></a>
          <a *ngIf="canDeleteComment(comment)" (click)="deleteComment(comment)"><i
            class="fa-regular fa-circle-xmark"></i></a>
        </div>
      </article>
    </div>


    <div *ngIf="showReview">

      <div *ngIf="isLoggedIn && !userHasReview">
        <article class="media mx-6" id="reviewStart">
          <figure class="media-left">
            <p class="image is-64x64">
              <img class="is-rounded" *ngIf="currentUser && currentUser.image !== ''"
                   [src]="'data:image/png;base64,' + currentUser.image" alt="Profile Picture">
              <img class="is-rounded" *ngIf="currentUser && currentUser.image === ''"
                   src="https://bulma.io/images/placeholders/128x128.png" alt="Profile Picture">
            </p>
          </figure>
          <!-- add review -->
          <form class="media-content" (submit)="addReview(reviewContent, userRating)">
            <div class="field">
              <p class="control">
                <textarea class="textarea is-half" (input)="emojiConvertReview(reviewContent)"
                          [(ngModel)]="reviewContent" name="content"
                          placeholder="Add a review..."></textarea>
              </p>
            </div>
            <div class="field">
              <label class="label">Your Rating:</label>
              <span class="star-rating">
                <i class="fa-solid fa-star" [ngClass]="{'active': userRating >= 1}" (click)="userRating = 1"></i>
                <i class="fa-solid fa-star" [ngClass]="{'active': userRating >= 2}" (click)="userRating = 2"></i>
                <i class="fa-solid fa-star" [ngClass]="{'active': userRating >= 3}" (click)="userRating = 3"></i>
                <i class="fa-solid fa-star" [ngClass]="{'active': userRating >= 4}" (click)="userRating = 4"></i>
                <i class="fa-solid fa-star" [ngClass]="{'active': userRating == 5}" (click)="userRating = 5"></i>
              </span>
            </div>
            <nav class="level">
              <div class="level-left">
                <div class="level-item">
                  <button class="button is-info is-primary" type="submit"
                          [disabled]="userRating === 0 || !reviewContent">Submit
                  </button>
                </div>
              </div>
            </nav>
          </form>
        </article>
      </div>
      <div *ngIf="isLoggedIn && userHasReview">
        Placeholder: You already have a review. Edit your review -here- (implement)
      </div>
      <hr>
      <article class="media mx-6" *ngFor="let review of game.reviews">
        <figure class="media-left">
          <p class="image is-64x64 is-rounded">
            <img class="is-rounded" *ngIf="review.enduser.image"
                 [src]="'data:image/png;base64,' + review.enduser.image" alt="Profile Picture">
            <img class="is-rounded" *ngIf="!review.enduser.image" src="https://bulma.io/images/placeholders/128x128.png"
                 alt="Profile Picture">
          </p>
        </figure>
        <div class="media-content">
          <div class="content">
            <div class="level is-mobile m-0">
              <div class="level-left">
                <strong>
                  {{ review.enduser.username }}
                </strong>
              </div>
              <div class="level-right">
        <span>
          <i class="fa-solid fa-star" [ngClass]="{'yellow': review.rating >= 1}"></i>
          <i class="fa-solid fa-star" [ngClass]="{'yellow': review.rating >= 2}"></i>
          <i class="fa-solid fa-star" [ngClass]="{'yellow': review.rating >= 3}"></i>
          <i class="fa-solid fa-star" [ngClass]="{'yellow': review.rating >= 4}"></i>
          <i class="fa-solid fa-star" [ngClass]="{'yellow': review.rating == 5}"></i>
        </span>
              </div>
            </div>
            <small>{{ review.createdAt | date:'HH:mm:ss dd-MM-yy' }}</small><br>
            <span>{{ review.content }}</span>
          </div>
        </div>

        <!-- edit review window -->
        <form class="media-content" (ngSubmit)="addReview(editReviewContent,review.rating)"
              *ngIf="reviewIdBeingEdited === review.id">
          <div class="field">
            <p class="control">
              <textarea class="textarea is-half" (input)="emojiConvertComment(editReviewContent)"
                        [(ngModel)]="editReviewContent" name="content"
                        placeholder="Edit your review..."></textarea>
            </p>
          </div>
          <nav class="level">
            <div class="level-left">
              <div class="level-item">
                <button class="button is-info is-primary" [disabled]="!editReviewContent" type="submit">Submit</button>
              </div>
            </div>
          </nav>
        </form>

        <!-- buttons for edit and delete -->

        <div class="media-right">
          <a class="mr-2" *ngIf="canEditReview(review)" (click)="showEditFormForReview(review)"><i class="fa-solid fa-pen"></i></a>
          <a *ngIf="canDeleteReview(review)" (click)="deleteReview(review)"><i class="fa-regular fa-circle-xmark"></i></a>
        </div>
      </article>

    </div>

  </div>
  <div class="column is-one-fifth"></div>
</div>
